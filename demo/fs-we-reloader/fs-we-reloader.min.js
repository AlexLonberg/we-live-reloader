/* WE-LiveReloader */(function(){'use strict';const a="WE-LiveReloader",b="color:#FF9800;font-weight:bold";var c=a=>{let{port:b,readInterval:c,filter:d,tabReload:e,userReload:f,bypassCache:g,disconnect:h}=a||{};return(!Number.isInteger(b)||0>b)&&(b=0),(!Number.isInteger(c)||100>c)&&(c=800),(!Number.isInteger(h)||0>h)&&(h=300000),1>h&&(h=86400000),"function"!==typeof d&&(d=null),"function"!==typeof f&&(f=null),e="undefined"===typeof e?false:!!e,g="undefined"===typeof g?false:!!g,{port:b,readInterval:c,filter:d,tabReload:e,userReload:f,bypassCache:g,disconnect:h}};(function(d){function e(){return new Promise((b,c)=>chrome.management.getSelf(({installType:d})=>{"development"===d?chrome.runtime.getPackageDirectoryEntry(d=>d?b(d):c(`${a}:\nОшибка получения DirectoryEntry.`)):c(`${a}:\nОтслеживание корневой директории расширения, возможно только в режим development.`)}))}function f(b){let c=[];return new Promise(d=>{b.createReader().readEntries(async(b,e)=>{if(e)console.error(`${a}:\n`,e);else for(let d of b)d.isFile?(!k||k(d.fullPath))&&(await new Promise(b=>d.file((e,f)=>{f?console.error(`${a}:\n`,f):c.push({path:d.fullPath,lastModified:e.lastModified}),b()}))):d.isDirectory&&c.push(...(await f(d)));d(c)})})}function g(){return new Promise(a=>chrome.tabs.query({active:true,currentWindow:true},([b])=>(b&&chrome.tabs.reload(b.id,{bypassCache:n}),a(b?b.url:null))))}async function h(a,b){let c=[];const d=()=>(a.splice(0),a.push(...c),a.push(...b)),e=b=>a.findIndex(({path:a})=>b===a);let g,h;for(;b.length;){if(g=b.shift(),h=e(g.path),-1===h||g.lastModified!==a[h].lastModified)return d(),true;a.splice(h,1),c.push(g)}let j=!!a.length;return d(),j}async function i(a){let b=await f(a.directoryEntry);(await h(a.old,b))?m?m():chrome.runtime.reload():setTimeout(i,j,a)}console.log(`%c${a}:\n`,b,"\u041F\u043E\u0434\u043A\u043B\u044E\u0447\u0435\u043D \u0441\u043A\u0440\u0438\u043F\u0442 \u043E\u0442\u0441\u043B\u0435\u0436\u0438\u0432\u0430\u043D\u0438\u044F \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u0439 \u0444\u0430\u0439\u043B\u043E\u0432 \u0434\u0438\u0440\u0435\u043A\u0442\u043E\u0440\u0438\u0438 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u044F.");const{readInterval:j,filter:k,tabReload:l,userReload:m,bypassCache:n}=c(d);void async function(){const c=await e();if(l){let c=await g();c&&console.log(`%c${a}:\n`,b,`Перезагружена вкладка ${c}`)}const d=await f(c);setTimeout(i,j,{directoryEntry:c,old:d})}()})()})();
